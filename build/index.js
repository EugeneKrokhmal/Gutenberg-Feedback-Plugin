(()=>{"use strict";const e=window.wp.blocks,a=window.wp.components,t=window.wp.blockEditor,l=window.wp.i18n,n=window.wp.element,c=({attributes:e})=>{const[a,t]=(0,n.useState)({firstName:"",lastName:"",email:"",subject:"",message:""});return(0,n.useEffect)((()=>{fetch("/wp-json/wp/v2/users/me",{credentials:"include"}).then((e=>{if(!e.ok)throw new Error((0,l.__)("Not logged in","feedback-plugin"));return e.json()})).then((e=>{t({firstName:e.first_name||"",lastName:e.last_name||"",email:e.email||"",subject:"",message:""})})).catch((()=>{}))}),[]),React.createElement("form",{className:"feedback-form"},React.createElement("h2",{id:"feedback-form-title"},(0,l.__)("Feedback Form","feedback-plugin")),React.createElement("div",null,React.createElement("label",{htmlFor:"firstName"},e.labelFirstName,e.isFirstNameRequired&&React.createElement("span",{className:"required"},"*")),React.createElement("input",{type:"text",id:"firstName",name:"firstName",required:e.isFirstNameRequired,"aria-required":e.isFirstNameRequired?"true":"false","aria-labelledby":"firstName-label",value:a.firstName,onChange:e=>t({...a,firstName:e.target.value})})),React.createElement("div",null,React.createElement("label",{htmlFor:"lastName"},e.labelLastName),React.createElement("input",{type:"text",id:"lastName",name:"lastName",value:a.lastName,"aria-labelledby":"lastName",onChange:e=>t({...a,lastName:e.target.value})})),React.createElement("div",null,React.createElement("label",{htmlFor:"email"},e.labelEmail,e.isEmailRequired&&React.createElement("span",{className:"required"},"*")),React.createElement("input",{type:"email",id:"email",name:"email",required:e.isEmailRequired,value:a.email,"aria-required":e.isEmailRequired?"true":"false","aria-labelledby":"email",onChange:e=>t({...a,email:e.target.value})})),React.createElement("div",null,React.createElement("label",{htmlFor:"subject"},e.labelSubject,e.isSubjectRequired&&React.createElement("span",{className:"required"},"*")),React.createElement("input",{type:"text",id:"subject",name:"subject",required:e.isSubjectRequired,"aria-required":e.isSubjectRequired?"true":"false","aria-labelledby":"subject",value:a.subject,onChange:e=>t({...a,subject:e.target.value})})),React.createElement("div",null,React.createElement("label",{htmlFor:"message"},e.labelMessage,e.isMessageRequired&&React.createElement("span",{className:"required"},"*")),React.createElement("textarea",{id:"message",name:"message",rows:"5",required:e.isMessageRequired,"aria-required":e.isMessageRequired?"true":"false","aria-labelledby":"message",value:a.message,onChange:e=>t({...a,message:e.target.value})})),React.createElement("button",{className:"wp-block-button__link wp-element-button",type:"submit","aria-label":(0,l.__)("Submit Feedback","feedback-plugin")},(0,l.__)("Submit","feedback-plugin")))};(0,e.registerBlockType)("feedback/form",{title:(0,l.__)("Feedback Form","feedback-plugin"),icon:"feedback",category:"widgets",attributes:{labelFirstName:{type:"string",default:(0,l.__)("First Name","feedback-plugin")},labelLastName:{type:"string",default:(0,l.__)("Last Name","feedback-plugin")},labelEmail:{type:"string",default:(0,l.__)("Email","feedback-plugin")},labelSubject:{type:"string",default:(0,l.__)("Subject","feedback-plugin")},labelMessage:{type:"string",default:(0,l.__)("Message","feedback-plugin")},isFirstNameRequired:{type:"boolean",default:!0},isLastNameRequired:{type:"boolean",default:!0},isEmailRequired:{type:"boolean",default:!0},isSubjectRequired:{type:"boolean",default:!0},isMessageRequired:{type:"boolean",default:!0}},edit:({attributes:e,setAttributes:n})=>React.createElement("div",null,React.createElement(t.InspectorControls,null,React.createElement(a.PanelBody,{title:(0,l.__)("Form Settings","feedback-plugin")},React.createElement(a.TextControl,{label:(0,l.__)("First Name Label","feedback-plugin"),value:e.labelFirstName,onChange:e=>n({labelFirstName:e})}),React.createElement(a.ToggleControl,{label:(0,l.__)("First Name Required","feedback-plugin"),checked:e.isFirstNameRequired,onChange:e=>n({isFirstNameRequired:e})}),React.createElement(a.TextControl,{label:(0,l.__)("Last Name Label","feedback-plugin"),value:e.labelLastName,onChange:e=>n({labelLastName:e})}),React.createElement(a.ToggleControl,{label:(0,l.__)("Last Name Required","feedback-plugin"),checked:e.isLastNameRequired,onChange:e=>n({isLastNameRequired:e})}),React.createElement(a.TextControl,{label:(0,l.__)("Email Label","feedback-plugin"),value:e.labelEmail,onChange:e=>n({labelEmail:e})}),React.createElement(a.ToggleControl,{label:(0,l.__)("Email Required","feedback-plugin"),checked:e.isEmailRequired,onChange:e=>n({isEmailRequired:e})}),React.createElement(a.TextControl,{label:(0,l.__)("Subject Label","feedback-plugin"),value:e.labelSubject,onChange:e=>n({labelSubject:e})}),React.createElement(a.ToggleControl,{label:(0,l.__)("Subject Required","feedback-plugin"),checked:e.isSubjectRequired,onChange:e=>n({isSubjectRequired:e})}),React.createElement(a.TextControl,{label:(0,l.__)("Message Label","feedback-plugin"),value:e.labelMessage,onChange:e=>n({labelMessage:e})}),React.createElement(a.ToggleControl,{label:(0,l.__)("Message Required","feedback-plugin"),checked:e.isMessageRequired,onChange:e=>n({isMessageRequired:e})}))),React.createElement(c,{attributes:e})),save:({attributes:e})=>React.createElement("div",{className:"feedback-form-container","data-attributes":JSON.stringify(e)},React.createElement("p",null,(0,l.__)("Loading feedback form...","feedback-plugin")))});const r=()=>{const[e,a]=(0,n.useState)([]),[t,c]=(0,n.useState)(1),[r,i]=(0,n.useState)(1),[s,u]=(0,n.useState)(null),[m,d]=(0,n.useState)(null),b=async(e=1)=>{d(null);try{const t=await fetch(feedbackEntriesData.ajaxUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"fetch_feedback_entries",page:e,_wpnonce:feedbackEntriesData.nonce})}),n=await t.json();n.success?(a(n.data.entries),i(n.data.totalPages),c(e)):d(n.message||(0,l.__)("Failed to load entries.","feedback-plugin"))}catch(e){d((0,l.__)("An error occurred while fetching entries.","feedback-plugin")),console.error(e)}};return React.createElement("div",{className:"feedback-entries"},React.createElement("h2",null,(0,l.__)("Feedback Entries","feedback-plugin")),m&&React.createElement("p",{className:"error-message",style:{color:"red"}},m),React.createElement("button",{onClick:()=>b(),className:"wp-block-button__link wp-element-button",type:"button","aria-label":(0,l.__)("Load Feedback Entries","feedback-plugin")},(0,l.__)("Load Entries","feedback-plugin")),e.length?React.createElement("ul",{className:"entries-list"},e.map((({id:e,first_name:a,last_name:t,email:n,subject:c})=>React.createElement("li",{key:e},React.createElement("a",{className:"entry-detail-link",onClick:()=>(async e=>{d(null);try{const a=await fetch(feedbackEntriesData.ajaxUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"fetch_feedback_entry_details",entry_id:e,_wpnonce:feedbackEntriesData.nonce})}),t=await a.json();t.success?u(t.data.entry):d(t.message||(0,l.__)("Failed to load entry details.","feedback-plugin"))}catch(e){d((0,l.__)("An error occurred while fetching entry details.","feedback-plugin")),console.error(e)}})(e),"aria-label":(0,l.__)("View details for entry","feedback-plugin")+` ${e}`},a," ",t," (",n,") - ",c))))):React.createElement("p",null,(0,l.__)("No entries found.","feedback-plugin")),(()=>{if(!s)return null;const{first_name:e,last_name:a,email:t,subject:n,message:c}=s;return React.createElement(React.Fragment,null,React.createElement("h3",null,(0,l.__)("Entry Details","feedback-plugin")),React.createElement("table",{className:"entry-details"},React.createElement("tbody",null,React.createElement("tr",null,React.createElement("th",{align:"left"},(0,l.__)("Name:","feedback-plugin")),React.createElement("td",null,e," ",a)),React.createElement("tr",null,React.createElement("th",{align:"left"},(0,l.__)("Email:","feedback-plugin")),React.createElement("td",null,t)),React.createElement("tr",null,React.createElement("th",{align:"left"},(0,l.__)("Subject:","feedback-plugin")),React.createElement("td",null,n)),React.createElement("tr",null,React.createElement("th",{align:"left"},(0,l.__)("Message:","feedback-plugin")),React.createElement("td",null,c)))))})(),r<=1?null:React.createElement("div",{className:"wp-pagination"},Array.from({length:r}).map(((e,a)=>{const l=a+1;return React.createElement("button",{key:l,onClick:()=>b(l),disabled:l===t,className:"pagination-button wp-block-button__link wp-element-button "+(l===t?"active":"")},l)}))))};(0,e.registerBlockType)("feedback/entries-list",{title:(0,l.__)("Feedback Entries List","feedback-plugin"),icon:"list-view",category:"widgets",edit:()=>React.createElement(r,null),save:()=>React.createElement("div",{className:"feedback-entries"},React.createElement("button",{className:"load-entries-button wp-block-button__link wp-element-button"},(0,l.__)("Load Entries","feedback-plugin")),React.createElement("ul",{className:"entries-list"}),React.createElement("div",{className:"entry-details"}),React.createElement("div",{className:"wp-pagination"}))})})();